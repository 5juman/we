# 이더리움 백서(pp.16~20)
## 블록체인과 채굴 - 마지막 두 개 단락
* 이러한 종류의 특별한 트리는 머클 트리 개념을 수정하여, 노드를 수정, 삽입, 삭제하여 이러한 작업을 수행할 수 있게 함.
* 모든 상태 정보가 마지막 블록에 포함되어 있어, 전체 블록체인 히스토리를 모두 저장할 필요가 없음. (-> 비트코인에 적용 : 5-20배 저장공간 절약 효과)
### <컨트랙트 코드는 어디서 실행되는가>
**컨트랙트 코드를 실행하는 프로세스는 상태 전환 함수 정의의 한 부분이며, 이것은 블록 검증 알고리즘의 한 부분**
  - 트랜잭션이 블록 B에 포함됨 -> 트랜잭션에 의한 코드의 실행 : 현재 or 향후에 블록 B를 다운로드/검증하는 모든 노드들에 의해 실행

## 어플리케이션(Application)
**이더리움을 이용하여 기본적으로 세 가지 카테고리의 어플리케이션을 제작할 수 있음**
1. 금융 어플리케이션
* 돈과 직접적으로 연관된 컨트랙트를 계약참여자들로 하여금 보다 강력하게 설정-관리하도록 하는 어플리케이션
    - 예) 하위화폐, 파생상품, 헷지컨트랙트, 예금융 전자지갑, 유언장, 최종적으로는 전면적인 고용계약 수준의 것들
3. 준금융 어플리케이션
* 금전이 관여되어 있지만, 상당부분 비화폐적인 면이 존재하는 계약을 위한 어플리케이션
    - 예) 어려운 연산 문제의 솔루션 제공 시 자동적으로 포상금이 지급되는 계약
5. 금융과 관련성이 전혀 없는 어플리케이션
    - 예) 온라인 투표, 분권형 거버넌스

 ## 토큰 시스템(Token Systems)
 **블록체인토큰시스템(On-blockchain token system)**

     이더리움에서 토큰시스템은 매우 쉽게 구현됨
     핵심 : 모든 화폐 혹은 토큰시스템의 근본은 "한 가지 오퍼레이션만 수행하는 데이터베이스"
     
     * A로부터 X단위 화폐/토큰 차감 -> 차감한 X단위의 화폐/토큰을 B에게 지급
       i. 거래 전, A는 최소 X단위 보유
       ii. A가 이 거래를 승인
       
     * 이더리움에서 유저 : 위의 로직을 컨트랙트에 반영만 하면 됨

![image](https://github.com/5juman/we/assets/169249800/cdae6d93-ca33-4d62-a9b7-166b1ae4e55c)

**이론적으로, '이더리움에 기반한 하위화폐 체계로서의 토큰시스템'은 비트코인에 기반한 메타화폐가 갖고 있지 않는 중요한 특징 지님**
    
**= 거래비용을 거래 시에 사용한 화폐로 직접 지불 가능**

다음의 과정을 통해 발현됨

    컨트랙트를 집행하기 위해선 발송인에게 지불한 비용만큼 이더 잔고를 유지해야 함
    집행 시 받는 수수료로 받는 내부화폐(하위화폐)를 이더 거래소에서 즉각 확전하여 이더 잔고로 충전
    이렇게 유저들은 계좌들을 "활성화"시켜야 함
    
    * 각 컨트랙트를 통해 얻는 금액을 이더로 매번 환전해 주기 때문에, 한 번 충전된 이더는 재사용이 가능함

###### 메타화폐 : 비트코인 블록체인에 연동된 화폐

## 금융파생상품(Financial derivatives)
**파생상품은 "스마트 컨트랙트" 가장 일반적인 어플리케이션**
**코드로 실행할 수 있는 가장 간단한 형태의 어플리케이션 중 하나**

* 금융 컨트랙트 실행에 가장 주된 어려움 : 대부분, 계약에서 규정하는 자산에 대한 시세를 외부에서 참조해야 한다는 것
* 예) 헷지컨트랙트 실행 위해선 ETH/USD 환율을 제공할 수 있는 컨트랙트가 필요함

헷지 컨트랙트는 다음과 같은 구조를 띰

    1. A가 1000 이더 임금할 때까지 기다린다
    2. B가 1000 이더 임금할 때까지 기다린다
    3. 임금된 이더의 달러가치를 기록, 이를 $X라고 기록한다
    4. 30일 후, 당시의 환율 적용한 금액을 계산, A에게는 $X 송금하고 당시 총금액의 나머지를 B에게 송금하도록 A또는 B가 컨트랙트를 다시 활성화시키도록 한다

_ _ _
위와 같은 컨트랙트는 **'가상통화를 이용한 상거래'의 향후 발전 가능성**을 제시

가상화폐 상거래 활성화의 장애물 중 하나는 **가상화폐의 높은 변동성**
  (= 블록체인자산이 제공하는 보안성과 편의성에 대한 니즈가 있지만, 하루만에 그들의 자산가치가 23% 하락할지도 모른다는 리스크는 피하고 싶어함)

지금까지의 가장 보편적인 솔루션 **= 자산 발행자가 자산에 대한 보증**을 서는 것
###### 발행자가 하위화폐 만들어 통화량 조절 권한을 갖고, 누군가가 일정 단위 하위화폐를 지불했을 때 그에 상응하는 특정한 베이스 자산(예: USD, 금)으로 교환해주는 방식

=> 이 메커니즘은 비가상화폐 혹은 비디지털자산을 블록체인자산화 시키는 결과를 낳음

_ _ _
다만, 현실적으로는 자산 발행일을 언제사 신뢰X, 금융인프라는 자산보증서비스가 존재하기에는 너무 취약/적대적
-> 파생상품이 대안 제공

: 자산 보증 위한 펀드 제공 역할을 한명의 자산 발행자가 하는 것이 아니라, 투자자들의 탈중앙화된 시장이 담당
: 완전한 탈중화된 방법론은 아님. 사기/조작 가능성이 아직 남아있어서 신뢰성 있는 제 3기관이 USD/ETH 시세 or 환율을 제공해야 하기 때문.

## 신원조회/평판 시스템(Identity and Reputation Systems)
최초의 알트코인(비트코인 이후에 생겨난 가상화폐)인 네임코인은 비트코인과 유사한 블록체인을 이용하여, 사용자가 공공 DB에 다른 데이터와 함께 본인 이름을 등록하는 명의등록 시스템을 만들어냄.

<이더리움에서 명의등록 시스템의 기본 컨트랙트>

![image](https://github.com/5juman/we/assets/169249800/61d930bf-24f0-4f0d-bda5-a209e2ac3c5b)

* 이더리움 네트워크 안에 저장되어 있으며 추가 가능하나 수정/삭제할 수 없는 데이터 베이스
* 누구던지 소량의 이더를 이용해 본인 명의 등록 가능
* 한 번 등록하면 영구적으로 보존됨

## 분산형 파일 저장소(Decentralized File System)
이더리움의 컨트랙트는 분산형 파일 저장소 생태계의 발전을 가능케 함.
(유저 개개인 : 본인의 하드드라이브 대여해주는 대가로 소액의 돈 받음, 하드디스크 공간이 남아 파일저장의 비용을 더욱 낮춤)

### 분산형 파일 저장소의 핵심 기반
**"분산형 드롭박스 컨트랙트"**

다음과 같이 작동

    1. 유저가 업로드하려는 데이터를 블록으로 잘라냄
    2. 해당 데이터를 암호화(프라이버시 위함)
    3. 그 데이터로 머클트리를 만듦

위 컨트랙트는 아래와 같은 룰에 의해 유지됨

    * N개의 블록마다 무작위 방식으로 머클트리의 인덱스를 뽑음
      (컨트랙트 코드로 접근가능한 전 블록의 해쉬에 기반한 무작위 방식)
    * 트리의 특정 인덱스에 대하여, 저장해주겠다는 의미로 첫 주체에게 X이더를 지불
    * 파일 올린 유저가 다시 자신의 파일 다운로드하고 싶을 때에는, 소액결제 채널 프로토콜을 사용해 파일 복원 가능

<분산형 드롭박스 컨트랙트의 중요 특징>

내가 올린 파일에 대한 분실 혹은 제 3자에 의한 도용 리스크를 거의 0에 가깝게 줄일 수 있다

## 탈중앙화된 자율조직(Decentralized Autonomous Organization)
기본 개념
: 특정한 집합의 구성원/주주들을 갖고 있는 가상 독립체(virtual entity)가 필요한 수만큼, 구성원의 동의하에 조직자금운용에 대한 권한 및 코드 변경 권한을 갖는다.

* 구성원들 : 그 조직이 어떻게 운영자금을 배분할지를 공동으로 결정
* DAO자금 배분 방식은 포상, 급여, 내부화폐 보상 형식까지 다양

**통상적으로 기업/비영리재단에서 사용하는 법적인 장치를 그대로 따르는 것이지만, 그 집행의 강제를 위해 암호화블록체인 기술을 사용한다는 차별점**
_ _ _

DAO 코딩 일반적인 개요

    * 가장 간단한 디자인 ; 구성원 2/3가 동의/거부 시 저절로 코드가 변경되는 컨셉
    * 간단한 DAO 컨트랙트에는 3가지 트랜잭션이 있음

![image](https://github.com/5juman/we/assets/169249800/38259640-da2c-4907-9e7a-e286f7f0222d)

* 컨트랙트 => 모든 오픈스토리지에 일어난 변화 & 변화에 투표한 리스트 & 전체 구성원을 보관
* 2/3 투표를 받으면, 마지막으로 확정시키는 트랜잭션이 그 변경을 집행할 수 있게 됨
* 투표위임을 통해 자기자신을 위해 투표할 수 있도록 할 수 있으며 이 권한은 전가될 수 있음

DAO와 비교되는 모델은 '탈중앙화된 기업'
: 각 어카운트는 0 또는 그 이상의 지분을 가질 수 있고, 어떤 결정을 내리기 위해서는 지분의 2/3이 필요

## 추가적인 어플리케이션(Further Applications)
### 1. 예금융 '전자지갑'
가정 : 펀드를 안전하게 보관하고 싶은 A는 펀드 잃어버리거나 Private Key 해킹을 우려함, 이더를 은행 B 와의 컨트랙트를 다음과 같은 방식으로 집어 넣을 것.

_ _ _
* A만이 그녀가 소유한 펀의의 최대 1%를 출금할 수 있다
* B 또한 하루에 1%를 출금할 수 있지만, A가 그녀의 Private Key를 통해 트랜스액션을 발송하여 B의 출금 권한을 없앨 수 있다
* 1% 이상의 금액을 출금하고 싶을 시, A는 B에게 상한 조정 허가를 요청할 수 있다
* A의 Private Key가 해킹 당했을 경우, A는 B에게 펀드를 새로운 컨트랙트로 이체하라고 요청할 수 있다
* " 분실하는 경우, B는 오랜 시간에 걸쳐서라도 펀드 금액 출금 가능
* B가 악당인 경우, A는 B에게 출금 권한 정지 가능
_ _ _

### 2. 작물보험
시세가 아닌 '날씨' 데이터피드를 이용해 파생상품을 손쉽게 만들 수 있음
이러한 어플리케이션은 자연재해 일반에 대한 보험상품으로 확대될 수 있을 것 

###### ex) 농부가 강수량 데이터와 역비례하게 지불금이 산출되는 파생상품을 산다면, 가뭄이 있을 때 농부는 자동적으로 보상을 받음
